global:
  namespace: investify
  imagePullPolicy: Always

  labels:
    app.kubernetes.io/name: investify
    app.kubernetes.io/instance: investify
    app.kubernetes.io/part-of: investify-app
    app.kubernetes.io/managed-by: argocd

replicaCount: 1

# Container Images (nginx + php-fpm)
image:
  nginx:
    repository: sangkips/investify-nginx
    tag: latest
    pullPolicy: IfNotPresent
  php:
    repository: sangkips/investify-php
    tag: latest
    pullPolicy: IfNotPresent

# Service Configuration
service:
  type: ClusterIP
  port: 80

# Ingress Configuration (Traefik)
ingress:
  enabled: true
  className: "traefik"
  hosts:
    - host: investify.autoscaleops.com
      paths:
        - path: /
          pathType: Prefix
  tls: true
  annotations:
    traefik.ingress.kubernetes.io/router.entrypoints: web,websecure
    traefik.ingress.kubernetes.io/router.tls: "true"
    cert-manager.io/cluster-issuer: letsencrypt-prod

# Resource limits
resources:
  nginx:
    requests:
      memory: "64Mi"
      cpu: "50m"
    limits:
      memory: "128Mi"
      cpu: "200m"
  php:
    requests:
      memory: "128Mi"
      cpu: "100m"
    limits:
      memory: "256Mi"
      cpu: "500m"

# Laravel environment variables
laravel:
  env:
    APP_ENV: "production"
    APP_DEBUG: "false"
    APP_URL: "https://investify.autoscaleops.com"
    LOG_CHANNEL: "stderr"
    CACHE_DRIVER: "redis"
    SESSION_DRIVER: "redis"
    QUEUE_CONNECTION: "redis"

# Health checks
healthCheck:
  path: "/health"  # or "/" or "/api/health"
  port: 80

# Supabase PostgreSQL Configuration
database:
  connection: "pgsql"
  host: ""          # Set via Vault secrets
  port: "5432"
  database: "postgres"
  username: "postgres"
  password: ""      # Set via Vault secrets

# Redis configuration (for Laravel cache/sessions/queues)
redis:
  enabled: true
  image:
    repository: redis
    tag: 7-alpine
    pullPolicy: IfNotPresent
  service:
    port: 6379
    targetPort: 6379
  resources:
    requests:
      memory: "64Mi"
      cpu: "50m"
    limits:
      memory: "128Mi"
      cpu: "100m"

# Laravel Queue Worker (optional)
worker:
  enabled: false
  replicas: 1
  command: ["php", "artisan", "queue:work", "--sleep=3", "--tries=3", "--max-time=3600"]
  resources:
    requests:
      memory: "128Mi"
      cpu: "50m"
    limits:
      memory: "256Mi"
      cpu: "200m"

# Laravel Scheduler (optional)
scheduler:
  enabled: false
  resources:
    requests:
      memory: "128Mi"
      cpu: "50m"
    limits:
      memory: "256Mi"
      cpu: "100m"

# Prometheus Monitoring Configuration
monitoring:
  enabled: true
  serviceMonitor:
    enabled: true
    labels:
      prometheus: investify
    interval: 30s
    scrapeTimeout: 10s
    path: /metrics

# External Secrets Configuration (Vault)
externalSecrets:
  enabled: true
  refreshInterval: "1h"
  
  vault:
    server: "http://vault.vault.svc.cluster.local:8200"
    path: "secret"
    version: "v2"
    secretPath: "investify/production"
    tokenSecretName: "vault-token"
    tokenSecretNamespace: "vault"
